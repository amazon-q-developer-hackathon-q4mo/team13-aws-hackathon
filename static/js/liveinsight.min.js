!function(e,t){"use strict";var n="https://k2eb4xeb24.execute-api.us-east-1.amazonaws.com/dev/api/events",i={sessionTimeout:18e5,retryAttempts:3,retryDelay:1e3,batchSize:10,flushInterval:5e3};function s(){this.siteKey=null,this.sessionId=null,this.userId=null,this.isInitialized=!1,this.eventQueue=[],this.flushTimer=null,this.handlePageView=this.handlePageView.bind(this),this.handleBeforeUnload=this.handleBeforeUnload.bind(this),this.handleVisibilityChange=this.handleVisibilityChange.bind(this)}s.prototype.init=function(e,t){if(this.isInitialized)return void console.warn("LiveInsight: Already initialized");if(!e)return void console.error("LiveInsight: Site key is required");if(this.siteKey=e,t)for(var n in t)i.hasOwnProperty(n)&&(i[n]=t[n]);this.initSession(),this.attachEventListeners(),this.startPeriodicFlush(),this.trackPageView(),this.isInitialized=!0,console.log("LiveInsight: Initialized successfully")},s.prototype.initSession=function(){var e=Date.now(),t=this.getStoredSession();t&&e-t.lastActivity<i.sessionTimeout?(this.sessionId=t.sessionId,this.userId=t.userId):(this.sessionId=this.generateUUID(),this.userId=this.getOrCreateUserId()),this.saveSession(e)},s.prototype.generateUUID=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})},s.prototype.getOrCreateUserId=function(){try{var e=localStorage.getItem("liveinsight_user_id");return e||(e=this.generateUUID(),localStorage.setItem("liveinsight_user_id",e)),e}catch(e){return"temp_"+Math.random().toString(36).substr(2,9)}},s.prototype.getStoredSession=function(){try{var e=localStorage.getItem("liveinsight_session");return e?JSON.parse(e):null}catch(e){return null}},s.prototype.saveSession=function(e){try{var t={sessionId:this.sessionId,userId:this.userId,lastActivity:e||Date.now(),startTime:e||Date.now()};localStorage.setItem("liveinsight_session",JSON.stringify(t))}catch(e){}},s.prototype.attachEventListeners=function(){var t=this;e.addEventListener?e.addEventListener("beforeunload",this.handleBeforeUnload,!1):e.attachEvent&&e.attachEvent("onbeforeunload",this.handleBeforeUnload),t.addEventListener&&t.addEventListener("visibilitychange",this.handleVisibilityChange,!1),e.history&&e.history.pushState&&(e.history.pushState=function(n){return function(){n.apply(e.history,arguments),setTimeout(function(){t.trackPageView()},100)}}(e.history.pushState))},s.prototype.trackPageView=function(){var t={event_type:"page_view",page_url:e.location.href,page_title:t.title,referrer:t.referrer,user_agent:navigator.userAgent,timestamp:Date.now(),session_id:this.sessionId,user_id:this.userId,site_key:this.siteKey};this.queueEvent(t)},s.prototype.track=function(t,n){if(!this.isInitialized)return void console.warn("LiveInsight: Not initialized");var i={event_type:t,page_url:e.location.href,timestamp:Date.now(),session_id:this.sessionId,user_id:this.userId,site_key:this.siteKey};if(n&&"object"==typeof n)for(var s in n)n.hasOwnProperty(s)&&(i[s]=n[s]);this.queueEvent(i)},s.prototype.queueEvent=function(e){this.eventQueue.push(e),this.eventQueue.length>=i.batchSize&&this.flushEvents()},s.prototype.startPeriodicFlush=function(){var e=this;this.flushTimer=setInterval(function(){e.eventQueue.length>0&&e.flushEvents()},i.flushInterval)},s.prototype.flushEvents=function(){if(0!==this.eventQueue.length){var e=this.eventQueue.splice(0,i.batchSize);this.sendEvents(e)}},s.prototype.sendEvents=function(t,i){i=i||1;var s=this;e.fetch?fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({events:t})}).then(function(e){if(!e.ok)throw new Error("HTTP "+e.status);console.log("LiveInsight: Events sent successfully")}).catch(function(e){console.warn("LiveInsight: Failed to send events",e),s.handleSendError(t,i)}):this.fallbackXHR(t,i)},s.prototype.fallbackXHR=function(e,t){var i=this,s=new XMLHttpRequest;s.open("POST",n,!0),s.setRequestHeader("Content-Type","application/json"),s.onreadystatechange=function(){4===s.readyState&&(s.status>=200&&s.status<300?console.log("LiveInsight: Events sent successfully"):(console.warn("LiveInsight: Failed to send events",s.status),i.handleSendError(e,t)))},s.send(JSON.stringify({events:e}))},s.prototype.handleSendError=function(e,t){if(t<i.retryAttempts){var n=this;setTimeout(function(){n.sendEvents(e,t+1)},i.retryDelay*t)}else console.error("LiveInsight: Failed to send events after",i.retryAttempts,"attempts")},s.prototype.handlePageView=function(){this.trackPageView()},s.prototype.handleBeforeUnload=function(){this.eventQueue.length>0&&this.flushEvents(),this.track("session_end")},s.prototype.handleVisibilityChange=function(){t.hidden?this.track("page_hidden"):(this.track("page_visible"),this.saveSession())},s.prototype.destroy=function(){this.flushTimer&&(clearInterval(this.flushTimer),this.flushTimer=null),this.flushEvents(),this.isInitialized=!1};var o=new s;e.LiveInsight={init:function(e,t){o.init(e,t)},track:function(e,t){o.track(e,t)},destroy:function(){o.destroy()}}}(window,document);