# LiveInsight 데이터베이스 설계

## DynamoDB 테이블 구조

### 1. Events 테이블
**Primary Key**: `event_id` (String)
**Sort Key**: `timestamp` (Number)

```json
{
  "event_id": "evt_20241201_123456_abc123",
  "timestamp": 1701432000000,
  "user_id": "user_abc123",
  "session_id": "sess_20241201_abc123",
  "event_type": "page_view",
  "page_url": "/products/item1",
  "referrer": "https://google.com",
  "user_agent": "Mozilla/5.0...",
  "ip_address": "192.168.1.1"
}
```

### 2. Sessions 테이블
**Primary Key**: `session_id` (String)

```json
{
  "session_id": "sess_20241201_abc123",
  "user_id": "user_abc123",
  "start_time": 1701432000000,
  "last_activity": 1701433800000,
  "is_active": true,
  "entry_page": "/home",
  "exit_page": "/products/item1",
  "referrer": "https://google.com",
  "total_events": 15,
  "session_duration": 1800
}
```

### 3. ActiveSessions 테이블 (실시간 조회용)
**Primary Key**: `session_id` (String)
**TTL**: `expires_at` (Number)

```json
{
  "session_id": "sess_20241201_abc123",
  "user_id": "user_abc123",
  "last_activity": 1701433800000,
  "current_page": "/products/item1",
  "expires_at": 1701435600
}
```

## 인덱스 설계

### GSI (Global Secondary Index)

#### Events-UserIndex
- **Partition Key**: `user_id`
- **Sort Key**: `timestamp`
- **용도**: 사용자별 이벤트 조회

#### Events-SessionIndex  
- **Partition Key**: `session_id`
- **Sort Key**: `timestamp`
- **용도**: 세션별 이벤트 조회

#### Sessions-UserIndex
- **Partition Key**: `user_id`
- **Sort Key**: `start_time`
- **용도**: 사용자별 세션 히스토리

## 데이터 접근 패턴

1. **실시간 활성 세션 조회**: ActiveSessions 테이블 스캔
2. **세션별 이벤트 조회**: Events-SessionIndex 쿼리
3. **사용자별 세션 히스토리**: Sessions-UserIndex 쿼리
4. **시간대별 통계**: Events 테이블 시간 범위 쿼리