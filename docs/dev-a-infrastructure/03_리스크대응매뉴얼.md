# 담당자 A - 리스크 대응 매뉴얼

## 🚨 긴급 상황 대응 가이드

### Phase별 최소 성공 기준
- **Phase 1 (4시간)**: DynamoDB + IAM 완성 → 담당자 B 로컬 개발 가능
- **Phase 2 (12시간)**: Lambda + API Gateway → 기본 API 동작
- **Phase 3 (18시간)**: 통합 테스트 → 데모 가능한 상태
- **Phase 4 (24시간)**: 문서화 + 발표 준비

## ⚠️ 주요 리스크 시나리오 및 대응

### 1. DynamoDB 스키마 변경 요청 (확률: 30%)
#### 상황
- 담당자 B가 2시간 후 스키마 변경 요청
- 기존 테이블 구조로는 요구사항 충족 불가

#### 즉시 대응 (5분 내)
```bash
# 현재 상태 백업
terraform state pull > backup-state.json

# 변경사항 적용 전 영향도 분석
terraform plan -out=schema-change.plan
```

#### 대응 방안
1. **변경 가능 (2시간 내)**: 즉시 스키마 수정 후 재배포
2. **변경 불가 (2시간 후)**: Phase 2에서 마이그레이션 계획
3. **긴급 상황**: 기본 스키마 유지, 애플리케이션 레벨에서 해결

### 2. Lambda 배포 실패 (확률: 40%)
#### 상황
- 코드 패키징 오류 또는 권한 문제
- terraform apply 시 Lambda 함수 생성 실패

#### 즉시 대응 (1분 내)
```bash
# 에러 로그 확인
terraform show
aws logs describe-log-groups --log-group-name-prefix "/aws/lambda/liveinsight"

# 더미 함수로 우선 배포
echo 'def handler(event, context): return {"statusCode": 200}' > dummy.py
zip dummy.zip dummy.py
```

#### 대응 방안
1. **더미 함수 배포**: 인프라 먼저 완성
2. **권한 재확인**: IAM 정책 점검
3. **수동 업로드**: AWS 콘솔에서 직접 업로드

### 3. API Gateway CORS 문제 (확률: 50%)
#### 상황
- 브라우저에서 CORS 에러 발생
- 프론트엔드에서 API 호출 불가

#### 즉시 대응 (30초 내)
```bash
# 와일드카드로 임시 해결
# terraform/api_gateway.tf에서 CORS 설정 확인
```

#### 대응 방안
1. **와일드카드 허용**: `Access-Control-Allow-Origin: *`
2. **OPTIONS 메서드 추가**: 모든 엔드포인트에 OPTIONS 추가
3. **수동 설정**: AWS 콘솔에서 직접 CORS 활성화

### 4. Terraform 상태 충돌 (확률: 20%)
#### 상황
- 동시 배포로 인한 상태 파일 잠금
- 상태 파일 손상 또는 불일치

#### 즉시 대응 (2분 내)
```bash
# 잠금 해제
terraform force-unlock LOCK_ID

# 상태 파일 복구
terraform state pull > current-state.json
terraform import aws_dynamodb_table.events liveinsight-events-dev
```

#### 대응 방안
1. **S3 백엔드 설정**: 상태 파일 중앙 관리
2. **DynamoDB 잠금**: 동시 접근 방지
3. **로컬 백업**: 정기적 상태 파일 백업

## 🔄 단계별 롤백 계획

### Phase 1 실패 시
```bash
# 최소한의 DynamoDB만 유지
terraform destroy -target=aws_lambda_function.event_collector
terraform destroy -target=aws_api_gateway_rest_api.main
# DynamoDB 테이블은 유지하여 담당자 B 개발 지원
```

### Phase 2 실패 시
```bash
# Lambda 없이 API Gateway만 테스트
# 더미 응답으로 프론트엔드 개발 지원
```

### Phase 3 실패 시
```bash
# 모니터링 없이 기본 기능만 유지
terraform destroy -target=aws_cloudwatch_metric_alarm.lambda_errors
```

## 📞 에스컬레이션 절차

### 1단계: 자체 해결 (5분)
- 문서 및 로그 확인
- 기본 트러블슈팅 실행

### 2단계: 담당자 B 협의 (10분)
- 요구사항 재확인
- 대안 방안 협의

### 3단계: 우선순위 조정 (15분)
- 핵심 기능 우선 완성
- 부가 기능 포기 결정

### 4단계: 최소 기능 구현 (30분)
- MVP 최소 요구사항만 충족
- 데모 가능한 수준으로 축소

## 🛠️ 응급 복구 도구

### 빠른 진단 스크립트
```bash
#!/bin/bash
# scripts/health-check.sh

echo "🔍 인프라 상태 점검..."

# Terraform 상태 확인
terraform state list | wc -l
echo "Terraform 리소스 수: $(terraform state list | wc -l)"

# AWS 리소스 확인
aws dynamodb list-tables --query 'TableNames[?contains(@, `liveinsight`)]'
aws lambda list-functions --query 'Functions[?contains(FunctionName, `liveinsight`)].FunctionName'
aws apigateway get-rest-apis --query 'items[?contains(name, `liveinsight`)].name'

echo "✅ 점검 완료"
```

### 긴급 배포 스크립트
```bash
#!/bin/bash
# scripts/emergency-deploy.sh

echo "🚨 긴급 배포 시작..."

# 최소 리소스만 배포
terraform apply -target=aws_dynamodb_table.events -auto-approve
terraform apply -target=aws_dynamodb_table.sessions -auto-approve
terraform apply -target=aws_iam_role.lambda_role -auto-approve

echo "✅ 최소 인프라 배포 완료"
```

## 📊 리스크 모니터링

### 실시간 체크리스트
- [ ] Terraform plan 에러 없음
- [ ] AWS 자격증명 유효
- [ ] DynamoDB 테이블 생성 완료
- [ ] IAM 역할 정상 동작
- [ ] Lambda 함수 배포 성공
- [ ] API Gateway 엔드포인트 응답

### 경고 신호
- ⚠️ Terraform plan에서 destroy 항목 발견
- ⚠️ AWS 비용 알람 발생
- ⚠️ Lambda 함수 에러율 10% 초과
- ⚠️ API Gateway 4xx/5xx 에러 증가

## 🎯 성공 확률 높이는 전략

### 1. 점진적 배포
- 한 번에 모든 리소스 배포 금지
- 단계별로 검증 후 다음 단계 진행

### 2. 더미 데이터 활용
- 실제 코드 없이도 인프라 테스트 가능
- 담당자 B 코드 완성 전에 미리 검증

### 3. 백업 계획 상시 준비
- 매 단계마다 상태 파일 백업
- 이전 단계로 즉시 롤백 가능한 상태 유지

이 매뉴얼을 참고하여 위기 상황에서도 침착하게 대응하여 프로젝트를 성공적으로 완수합시다! 🚀