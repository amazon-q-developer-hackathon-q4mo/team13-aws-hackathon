# LiveInsight AWS 리소스 관리 문서

## 📊 배포 정보 (Phase 1-2 완료)
- **AWS 리전**: us-east-1
- **환경**: dev
- **배포 상태**: ✅ 완료 (59개 리소스)
- **API Gateway ID**: k2eb4xeb24
- **CloudFront Distribution ID**: E2IKLPPDM8PJW3
- **S3 Bucket**: liveinsight-static-dev-c02ed440

## 🗂️ 생성된 리소스 목록 (총 59개)

### 🗄️ DynamoDB 테이블 (2개)
| 리소스명 | 타입 | 용도 | 특징 |
|---------|------|------|------|
| liveinsight-events-dev | DynamoDB Table | 이벤트 데이터 저장 | TTL 24시간, GSI 포함 |
| liveinsight-sessions-dev | DynamoDB Table | 세션 데이터 저장 | ActivityIndex GSI |

### ⚡ Lambda 함수 (3개)
| 리소스명 | 타입 | 용도 | 상태 |
|---------|------|------|------|
| liveinsight-event-collector-dev | Lambda Function | POST /api/events | ✅ 배포완료 |
| liveinsight-realtime-api-dev | Lambda Function | GET /api/realtime | ✅ 배포완료 |
| liveinsight-stats-api-dev | Lambda Function | GET /api/stats | ✅ 배포완료 |

### 🌐 API Gateway (1개 + 6개 메서드)
| 리소스명 | 타입 | URL | 상태 |
|---------|------|-----|------|
| liveinsight-api-dev | REST API | https://k2eb4xeb24.execute-api.us-east-1.amazonaws.com/dev | ✅ 활성화 |

### 🪣 S3 + CloudFront (정적 파일 호스팅)
| 리소스명 | 타입 | URL | 용도 |
|---------|------|-----|------|
| liveinsight-static-dev-c02ed440 | S3 Bucket | http://liveinsight-static-dev-c02ed440.s3-website-us-east-1.amazonaws.com | 정적 파일 |
| E2IKLPPDM8PJW3 | CloudFront | https://d28t8gs7tn78ne.cloudfront.net | 글로벌 CDN |

### 🔐 IAM 역할 및 정책 (3개)
| 리소스명 | 타입 | 용도 | 권한 |
|---------|------|------|------|
| liveinsight-lambda-role-dev | IAM Role | Lambda 실행 역할 | DynamoDB 읽기/쓰기 |
| lambda_dynamodb_policy | IAM Policy | DynamoDB 접근 | GetItem, PutItem, Query 등 |
| lambda_basic_execution | IAM Policy Attachment | CloudWatch 로그 | 로그 생성/쓰기 |

### 📊 CloudWatch 모니터링 (12개)
| 리소스명 | 타입 | 용도 | 임계값 |
|---------|------|------|--------|
| event_collector_errors | Metric Alarm | Lambda 에러 모니터링 | 5개/5분 |
| realtime_api_errors | Metric Alarm | Lambda 에러 모니터링 | 5개/5분 |
| stats_api_errors | Metric Alarm | Lambda 에러 모니터링 | 5개/5분 |
| api_gateway_4xx_errors | Metric Alarm | API 4xx 에러 | 10개/5분 |
| api_gateway_5xx_errors | Metric Alarm | API 5xx 에러 | 5개/5분 |
| dynamodb_events_read_throttles | Metric Alarm | DynamoDB 스로틀링 | 1개/5분 |
| dynamodb_events_write_throttles | Metric Alarm | DynamoDB 스로틀링 | 1개/5분 |
| event_collector_duration | Metric Alarm | Lambda 실행시간 | 25초 |

### 📝 CloudWatch 로그 그룹 (4개)
| 리소스명 | 보존기간 | 용도 |
|---------|----------|------|
| /aws/lambda/liveinsight-event-collector-dev | 7일 | Lambda 로그 |
| /aws/lambda/liveinsight-realtime-api-dev | 7일 | Lambda 로그 |
| /aws/lambda/liveinsight-stats-api-dev | 7일 | Lambda 로그 |
| API-Gateway-Execution-Logs_k2eb4xeb24/dev | 7일 | API Gateway 로그 |

## 🛠️ 리소스 관리 명령어

### 현재 상태 확인
```bash
cd terraform

# 배포된 리소스 목록 확인 (59개)
terraform state list

# 출력값 확인 (URL 정보)
terraform output

# 특정 리소스 상세 정보
terraform state show aws_api_gateway_rest_api.liveinsight_api
```

### 리소스 업데이트
```bash
cd terraform

# 변경사항 확인
terraform plan

# 변경사항 적용
terraform apply

# 특정 리소스만 업데이트
terraform apply -target=aws_lambda_function.event_collector
```

### Lambda 함수 코드 업데이트
```bash
# 담당자 B 코드 배포 시 사용
aws lambda update-function-code \
  --function-name liveinsight-event-collector-dev \
  --zip-file fileb://function.zip

# 환경변수 확인
aws lambda get-function-configuration \
  --function-name liveinsight-event-collector-dev
```

### 리소스 삭제 (주의!)
```bash
cd terraform

# 삭제 계획 확인
terraform plan -destroy

# 전체 리소스 삭제
terraform destroy

# 특정 리소스만 삭제
terraform destroy -target=aws_s3_bucket.static_files
```

## 💰 비용 관리

### 현재 설정
- **DynamoDB**: On-Demand 모드 (사용량 기반 과금)
- **Lambda**: 256MB, 30초 타임아웃
- **API Gateway**: REST API (요청당 과금)
- **CloudFront**: 글로벌 배포 (트래픽 기반)
- **S3**: 표준 스토리지 (저장량 기반)

### 예상 비용 (개발 환경)
- **월 예상 비용**: $3-8 (트래픽에 따라)
- **DynamoDB**: $0.25/GB + $1.25/백만 요청
- **Lambda**: $0.20/백만 요청 + $0.0000166667/GB-초
- **API Gateway**: $3.50/백만 요청
- **CloudFront**: $0.085/GB (첫 10TB)

### 비용 최적화 설정
- DynamoDB TTL: 24시간 자동 삭제
- CloudWatch 로그: 7일 보존
- Lambda 메모리: 256MB (최적화됨)

## 🔒 보안 설정

### IAM 최소 권한 원칙
- Lambda 함수별 개별 실행 역할
- DynamoDB 테이블별 세분화된 권한
- CloudWatch 로그 쓰기 권한만 부여

### 데이터 보호
- DynamoDB 암호화: AWS 관리형 키 사용
- TTL 설정: 24시간 후 자동 데이터 삭제
- API Gateway CORS: 개발용 와일드카드 설정

### 네트워크 보안
- HTTPS 강제 (API Gateway, CloudFront)
- S3 버킷 퍼블릭 액세스 차단
- CloudFront OAC 설정

## 📊 모니터링 및 알람

### 설정된 알람 (8개)
1. **Lambda 에러 알람**: 5분간 5개 이상 에러 시 알림
2. **API Gateway 에러**: 4xx/5xx 에러율 모니터링
3. **DynamoDB 스로틀링**: 읽기/쓰기 제한 모니터링
4. **Lambda 실행시간**: 25초 이상 시 알림

### 로그 확인 방법
```bash
# Lambda 로그 실시간 확인
aws logs tail /aws/lambda/liveinsight-event-collector-dev --follow

# API Gateway 로그 확인
aws logs tail API-Gateway-Execution-Logs_k2eb4xeb24/dev --follow

# 에러 로그만 필터링
aws logs filter-log-events \
  --log-group-name /aws/lambda/liveinsight-event-collector-dev \
  --filter-pattern "ERROR"
```

## ⚠️ 주의사항 및 제한사항

### 현재 알려진 이슈
- **OPTIONS 메서드**: 500 에러 반환 (기능상 문제없음)
- **더미 코드**: 실제 비즈니스 로직 구현 필요
- **인증 없음**: 개발 환경용 (프로덕션에서 추가 필요)

### 운영 시 고려사항
- **데이터 백업**: DynamoDB 백업 정책 수립 필요
- **환경 분리**: prod 환경 별도 구축 권장
- **도메인 연결**: Route 53 + ACM 인증서 필요
- **API 인증**: API Key 또는 Cognito 연동 고려

### 리소스 변경 시 주의점
- **DynamoDB 스키마 변경**: 데이터 마이그레이션 필요
- **Lambda 런타임 변경**: 코드 호환성 확인
- **API Gateway 변경**: 클라이언트 URL 업데이트
- **리전 변경**: 모든 리소스 재생성 (데이터 손실)

## 🤝 담당자 B 협업 가이드

### 제공 가능한 정보
- **API Base URL**: https://k2eb4xeb24.execute-api.us-east-1.amazonaws.com/dev
- **DynamoDB 테이블명**: liveinsight-events-dev, liveinsight-sessions-dev
- **Lambda 함수명**: liveinsight-{service}-dev
- **환경변수**: EVENTS_TABLE, SESSIONS_TABLE 자동 설정

### 코드 배포 지원
- Lambda 함수 업데이트 스크립트 제공
- 환경변수 설정 자동화
- 로그 모니터링 및 디버깅 지원
- API 테스트 환경 제공

---
**마지막 업데이트**: Phase 1-2 완료 시점  
**총 배포 리소스**: 59개  
**문서 버전**: 2.0 (최신화 완료)