# LiveInsight ë°°í¬ ì •ë³´ í…œí”Œë¦¿

> ì´ íŒŒì¼ì€ ì‹¤ì œ ë°°í¬ í›„ ë‹´ë‹¹ì Bì—ê²Œ ì œê³µí•  ì •ë³´ì˜ í…œí”Œë¦¿ì…ë‹ˆë‹¤.  
> ì‹¤ì œ ë°°í¬ ì •ë³´ëŠ” `DEPLOYMENT_INFO.md` íŒŒì¼ë¡œ ë³„ë„ ìƒì„±ë©ë‹ˆë‹¤.

## ğŸš€ ë°°í¬ ìƒíƒœ í…œí”Œë¦¿
- **Phase 1**: âœ… ì™„ë£Œ (ê¸°ì´ˆ ì¸í”„ë¼)
- **Phase 2**: âœ… ì™„ë£Œ (í•µì‹¬ ì¸í”„ë¼)
- **ë°°í¬ ì¼ì‹œ**: `<DEPLOYMENT_DATE>`
- **ë°°í¬ ë¦¬ì „**: `<AWS_REGION>`
- **í™˜ê²½**: `<ENVIRONMENT>`

## ğŸŒ API ì—”ë“œí¬ì¸íŠ¸ êµ¬ì¡°

### Base URL í˜•ì‹
```
https://<API_GATEWAY_ID>.execute-api.<AWS_REGION>.amazonaws.com/<ENVIRONMENT>
```

### ì—”ë“œí¬ì¸íŠ¸ êµ¬ì„±
| ë©”ì„œë“œ | ê²½ë¡œ | Lambda í•¨ìˆ˜ íŒ¨í„´ | ìš©ë„ |
|--------|------|------------------|------|
| POST | `/api/events` | `liveinsight-event-collector-<ENV>` | ì´ë²¤íŠ¸ ìˆ˜ì§‘ |
| GET | `/api/realtime` | `liveinsight-realtime-api-<ENV>` | ì‹¤ì‹œê°„ ë°ì´í„° ì¡°íšŒ |
| GET | `/api/stats` | `liveinsight-stats-api-<ENV>` | í†µê³„ ë°ì´í„° ì¡°íšŒ |

### API í…ŒìŠ¤íŠ¸ í…œí”Œë¦¿
```bash
# Stats API í…ŒìŠ¤íŠ¸
curl -X GET "https://<API_GATEWAY_ID>.execute-api.<AWS_REGION>.amazonaws.com/<ENV>/api/stats"

# Events API í…ŒìŠ¤íŠ¸
curl -X POST "https://<API_GATEWAY_ID>.execute-api.<AWS_REGION>.amazonaws.com/<ENV>/api/events" \
  -H "Content-Type: application/json" \
  -d '{"event_type": "page_view", "timestamp": 1693900000}'
```

## ğŸ—„ï¸ ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ

### DynamoDB í…Œì´ë¸” êµ¬ì¡°
| í…Œì´ë¸”ëª… íŒ¨í„´ | ìš©ë„ | Hash Key | Range Key |
|---------------|------|----------|-----------|
| `liveinsight-events-<ENV>` | ì´ë²¤íŠ¸ ì €ì¥ | session_id | timestamp |
| `liveinsight-sessions-<ENV>` | ì„¸ì…˜ ê´€ë¦¬ | session_id | - |

### Events í…Œì´ë¸” ìŠ¤í‚¤ë§ˆ
```json
{
  "session_id": "string",
  "timestamp": "number",
  "event_type": "string",
  "page_url": "string",
  "user_agent": "string",
  "referrer": "string",
  "ttl": "number"
}
```

### Sessions í…Œì´ë¸” ìŠ¤í‚¤ë§ˆ
```json
{
  "session_id": "string",
  "is_active": "string",
  "last_activity": "number",
  "start_time": "number",
  "user_agent": "string",
  "initial_referrer": "string"
}
```

## ğŸ”§ Lambda í•¨ìˆ˜ êµ¬ì„±

### í™˜ê²½ ë³€ìˆ˜ íŒ¨í„´
ëª¨ë“  Lambda í•¨ìˆ˜ì— ë‹¤ìŒ í™˜ê²½ ë³€ìˆ˜ê°€ ì„¤ì •ë©ë‹ˆë‹¤:
```
EVENTS_TABLE=liveinsight-events-<ENV>
SESSIONS_TABLE=liveinsight-sessions-<ENV>
AWS_REGION=<AWS_REGION>
```

### í•¨ìˆ˜ ì„¤ì •
- **Runtime**: Python 3.11
- **Memory**: 256MB
- **Timeout**: 30ì´ˆ
- **IAM Role**: `liveinsight-lambda-role-<ENV>`

### ê¶Œí•œ
Lambda í•¨ìˆ˜ëŠ” ë‹¤ìŒ DynamoDB ì‘ì—… ê¶Œí•œì„ ê°€ì§‘ë‹ˆë‹¤:
- GetItem, PutItem, Query, Scan
- UpdateItem, DeleteItem
- BatchWriteItem, BatchGetItem

## ğŸŒ ëŒ€ì‹œë³´ë“œ ì ‘ê·¼

### URL êµ¬ì¡°
- **CloudFront**: `https://<CLOUDFRONT_DOMAIN>`
- **S3 Direct**: `http://<S3_BUCKET>.s3-website-<AWS_REGION>.amazonaws.com`

### ì •ì  íŒŒì¼ ì—…ë¡œë“œ ë°©ë²•
```bash
# S3 ë²„í‚·ì— íŒŒì¼ ì—…ë¡œë“œ
aws s3 cp your-file.html s3://<S3_BUCKET>/

# CloudFront ìºì‹œ ë¬´íš¨í™” (í•„ìš”ì‹œ)
aws cloudfront create-invalidation --distribution-id <DISTRIBUTION_ID> --paths "/*"
```

## ğŸ“Š ëª¨ë‹ˆí„°ë§ êµ¬ì„±

### CloudWatch ë¡œê·¸ ê·¸ë£¹ íŒ¨í„´
- `/aws/lambda/liveinsight-event-collector-<ENV>`
- `/aws/lambda/liveinsight-realtime-api-<ENV>`
- `/aws/lambda/liveinsight-stats-api-<ENV>`
- `API-Gateway-Execution-Logs_<API_GATEWAY_ID>/<ENV>`

### ë¡œê·¸ í™•ì¸ ëª…ë ¹ì–´ í…œí”Œë¦¿
```bash
# Lambda ë¡œê·¸ ì‹¤ì‹œê°„ í™•ì¸
aws logs tail /aws/lambda/liveinsight-event-collector-<ENV> --follow

# ì—ëŸ¬ ë¡œê·¸ë§Œ í•„í„°ë§
aws logs filter-log-events \
  --log-group-name /aws/lambda/liveinsight-event-collector-<ENV> \
  --filter-pattern "ERROR"
```

## ğŸ”„ ì½”ë“œ ë°°í¬ ê°€ì´ë“œ

### Lambda í•¨ìˆ˜ ì½”ë“œ ì—…ë°ì´íŠ¸
```bash
# 1. ì½”ë“œ ì••ì¶• (requirements.txt í¬í•¨)
zip -r function.zip src/ requirements.txt

# 2. í•¨ìˆ˜ ì—…ë°ì´íŠ¸
aws lambda update-function-code \
  --function-name liveinsight-event-collector-<ENV> \
  --zip-file fileb://function.zip

# 3. ë°°í¬ í™•ì¸
aws lambda get-function --function-name liveinsight-event-collector-<ENV>
```

### í™˜ê²½ ë³€ìˆ˜ ê´€ë¦¬
```bash
# í˜„ì¬ í™˜ê²½ ë³€ìˆ˜ í™•ì¸
aws lambda get-function-configuration \
  --function-name liveinsight-event-collector-<ENV>

# í™˜ê²½ ë³€ìˆ˜ ì—…ë°ì´íŠ¸ (í•„ìš”ì‹œ)
aws lambda update-function-configuration \
  --function-name liveinsight-event-collector-<ENV> \
  --environment Variables='{EVENTS_TABLE=liveinsight-events-<ENV>,SESSIONS_TABLE=liveinsight-sessions-<ENV>}'
```

## ğŸš¨ ì£¼ì˜ì‚¬í•­

### CORS ì„¤ì •
- ëª¨ë“  API ì—”ë“œí¬ì¸íŠ¸ì— CORSê°€ ì„¤ì •ë˜ì–´ ìˆìŠµë‹ˆë‹¤
- Origin: `*` (ëª¨ë“  ë„ë©”ì¸ í—ˆìš©)
- Methods: `GET, POST, OPTIONS`
- Headers: `Content-Type, X-API-Key, Authorization`

### í˜„ì¬ ì•Œë ¤ì§„ ì´ìŠˆ
- OPTIONS ë©”ì„œë“œê°€ 500 ì—ëŸ¬ ë°˜í™˜ (ê¸°ëŠ¥ìƒ ë¬¸ì œì—†ìŒ)
- ì‹¤ì œ Lambda ì½”ë“œ êµ¬í˜„ í•„ìš” (í˜„ì¬ ë”ë¯¸ ì‘ë‹µ)

### ë³´ì•ˆ ê³ ë ¤ì‚¬í•­
- APIì— ì¸ì¦ì´ ì„¤ì •ë˜ì–´ ìˆì§€ ì•ŠìŒ (ê°œë°œ í™˜ê²½)
- DynamoDB í…Œì´ë¸”ì— TTL ì„¤ì •ë¨ (ìë™ ë°ì´í„° ì‚­ì œ)

## ğŸ¤ í˜‘ì—… ê°€ì´ë“œ

### ì½”ë“œ êµ¬ì¡° ê¶Œì¥ì‚¬í•­
```
src/
â”œâ”€â”€ handlers/
â”‚   â”œâ”€â”€ event_collector.py
â”‚   â”œâ”€â”€ realtime_api.py
â”‚   â””â”€â”€ stats_api.py
â”œâ”€â”€ models/
â”‚   â”œâ”€â”€ events.py
â”‚   â””â”€â”€ sessions.py
â””â”€â”€ utils/
    â”œâ”€â”€ dynamodb.py
    â””â”€â”€ response.py
```

### ì‘ë‹µ í˜•ì‹ í†µì¼
```python
# ì„±ê³µ ì‘ë‹µ
{
    "statusCode": 200,
    "headers": {
        "Content-Type": "application/json",
        "Access-Control-Allow-Origin": "*"
    },
    "body": json.dumps({
        "status": "success",
        "data": {...}
    })
}

# ì—ëŸ¬ ì‘ë‹µ
{
    "statusCode": 400,
    "headers": {
        "Content-Type": "application/json",
        "Access-Control-Allow-Origin": "*"
    },
    "body": json.dumps({
        "status": "error",
        "message": "Error description"
    })
}
```

## ğŸ“ ë¬¸ì˜ì‚¬í•­
ì¸í”„ë¼ ê´€ë ¨ ë¬¸ì˜ì‚¬í•­ì´ ìˆìœ¼ë©´ ë‹´ë‹¹ì Aì—ê²Œ ì—°ë½í•˜ì„¸ìš”.

---
**ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸**: `<UPDATE_DATE>`
**ë¬¸ì„œ ë²„ì „**: 2.0

## ğŸ“ í…œí”Œë¦¿ ì‚¬ìš© ë°©ë²•

### ì‹¤ì œ ë°°í¬ ì •ë³´ ìƒì„±
1. **ë°°í¬ ì™„ë£Œ í›„**: `terraform output` ëª…ë ¹ìœ¼ë¡œ ì‹¤ì œ ê°’ í™•ì¸
2. **íŒŒì¼ ìƒì„±**: ì´ í…œí”Œë¦¿ì„ ë³µì‚¬í•˜ì—¬ `DEPLOYMENT_INFO.md` ìƒì„±
3. **ê°’ êµì²´**: ëª¨ë“  `<PLACEHOLDER>` ë¥¼ ì‹¤ì œ ë°°í¬ëœ ê°’ìœ¼ë¡œ êµì²´
4. **ë³´ì•ˆ**: `DEPLOYMENT_INFO.md`ëŠ” `.gitignore`ì— í¬í•¨ (GitHub ì—…ë¡œë“œ ë°©ì§€)

### Terraform ì¶œë ¥ê°’ í™•ì¸
```bash
cd terraform
terraform output  # ëª¨ë“  ì¶œë ¥ê°’ í™•ì¸
terraform output api_gateway_url  # íŠ¹ì • ê°’ë§Œ í™•ì¸
```

### í”Œë ˆì´ìŠ¤í™€ë” ëª©ë¡
- `<API_GATEWAY_ID>`: API Gateway ID
- `<AWS_REGION>`: AWS ë¦¬ì „ (ì˜ˆ: us-east-1)
- `<ENVIRONMENT>`: í™˜ê²½ (dev/prod)
- `<CLOUDFRONT_DOMAIN>`: CloudFront ë„ë©”ì¸
- `<S3_BUCKET>`: S3 ë²„í‚·ëª…
- `<DEPLOYMENT_DATE>`: ë°°í¬ ì¼ì‹œ