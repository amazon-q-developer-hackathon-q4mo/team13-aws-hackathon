# 담당자 A - 인프라 개발 작업계획

## 📋 전체 작업 개요
- **담당자**: A (인프라 전문가)
- **기간**: 24시간 해커톤
- **주요 역할**: Terraform 인프라 구축, AWS 리소스 배포, 모니터링 설정

## 🕐 시간별 작업 계획

### Phase 1: 0-4시간 (기초 인프라 설정) ✅ 완료
#### ✅ 완료된 작업
- [x] Terraform 프로젝트 초기 설정
- [x] DynamoDB 테이블 설계 및 생성 (Events, Sessions)
- [x] IAM 역할 및 권한 설정 (최소 권한 원칙)
- [x] Lambda 함수 기본 구조 설정 (3개 함수)
- [x] API Gateway 기본 구조 설정 (CORS 포함)
- [x] 첫 번째 terraform apply 성공 (59개 리소스 배포)

#### 📁 생성된 파일들
```
terraform/
├── main.tf          ✅ 완료
├── variables.tf     ✅ 완료  
├── outputs.tf       ✅ 완료
├── dynamodb.tf      ✅ 완료
├── iam.tf           ✅ 완료
├── lambda.tf        ✅ 완료
├── api_gateway.tf   ✅ 완료
├── s3.tf            ✅ 완료
└── monitoring.tf    ✅ 완료
```

### Phase 2: 4-12시간 (핵심 인프라 구현) ✅ 완료
#### ✅ 완료된 작업
- [x] Lambda 함수 배포 및 테스트 환경 구축 (더미 코드로 배포 완료)
- [x] API Gateway CORS 설정 및 엔드포인트 연결 (3개 엔드포인트)
- [x] DynamoDB 인덱스 및 성능 최적화 (GSI, TTL 설정)
- [x] CloudWatch 로그 및 모니터링 설정 (8개 알람)
- [x] S3 + CloudFront 정적 파일 호스팅 (글로벌 CDN)
- [x] 전체 시스템 통합 테스트 환경 구축

#### 🎯 핵심 목표 ✅ 달성
- ✅ 담당자 B가 개발한 Lambda 함수 코드 배포 가능한 환경 구축
- ✅ API 엔드포인트 3개 연결: `/api/events`, `/api/realtime`, `/api/stats`
- ✅ 배포된 URL: https://k2eb4xeb24.execute-api.us-east-1.amazonaws.com/dev
- ✅ 대시보드 URL: https://d28t8gs7tn78ne.cloudfront.net
- ✅ 총 59개 AWS 리소스 성공적으로 배포
- ✅ 모니터링 및 알람 시스템 구축 완료

### Phase 3: 12-18시간 (고급 기능 및 최적화) 🔄 진행 중
#### ✅ 완료된 작업
- [x] 운영 환경 배포 준비 (terraform apply 완료)
- [x] 모니터링 대시보드 구성 (CloudWatch 알람 8개)
- [x] 보안 설정 강화 (CSRF, 입력 검증, S3 보안)
- [x] 코드 중복 제거 (Terraform 최적화 135줄 감소)

#### 🔄 진행 중인 작업
- [ ] **담당자 B 코드 통합 배포 지원** ⬅️ **현재 작업**
- [ ] 성능 테스트 및 병목 현상 해결
- [ ] 최종 보안 검토 및 문서화

📋 **상세 계획**: [Phase 3 작업계획](03_phase3_작업계획.md)

### Phase 4: 18-24시간 (통합 테스트 및 운영 준비) 📋 계획
#### 📋 작업 목록
- [x] 전체 시스템 배포 (인프라 완료)
- [x] 배포 스크립트 작성 (scripts/deploy.sh)
- [ ] 담당자 B와 통합 테스트
- [ ] 데모용 샘플 데이터 생성 스크립트
- [ ] 성능 모니터링 및 로그 분석
- [ ] 최종 데모 준비 및 문서화

## 🏗️ 인프라 아키텍처

### AWS 리소스 목록
1. **DynamoDB 테이블 (2개)**
   - `liveinsight-events-dev`: 이벤트 데이터
   - `liveinsight-sessions-dev`: 세션 데이터

2. **Lambda 함수 (3개)**
   - `liveinsight-event-collector-dev`: POST /api/events
   - `liveinsight-realtime-api-dev`: GET /api/realtime  
   - `liveinsight-stats-api-dev`: GET /api/stats

3. **API Gateway**
   - REST API 타입
   - CORS 활성화
   - Rate Limiting: 1000 req/min

4. **S3 + CloudFront**
   - 정적 파일 호스팅 (대시보드)
   - 글로벌 CDN 배포

5. **IAM 역할**
   - Lambda 실행 역할
   - DynamoDB 접근 권한

6. **CloudWatch**
   - 로그 그룹
   - 메트릭 알람

## 🔧 기술 스펙

### DynamoDB 스키마
#### Events 테이블
```
PK: session_id (String)
SK: timestamp (Number)
Attributes:
- event_type: String
- page_url: String
- user_agent: String
- referrer: String
- ttl: Number (24시간 후 삭제)

GSI: EventTypeIndex
- PK: event_type
- SK: timestamp
```

#### Sessions 테이블
```
PK: session_id (String)
Attributes:
- user_id: String
- start_time: Number
- last_activity: Number
- is_active: Boolean
- page_count: Number
- referrer: String

GSI: ActivityIndex
- PK: is_active
- SK: last_activity
```

### Lambda 함수 설정
- **Runtime**: Python 3.11
- **Memory**: 256MB
- **Timeout**: 30초
- **Environment Variables**:
  - `EVENTS_TABLE`: DynamoDB 테이블명
  - `SESSIONS_TABLE`: DynamoDB 테이블명
  - `AWS_REGION`: us-east-1

## 📊 모니터링 계획

### CloudWatch 알람
1. **Lambda 에러 알람**
   - 5분간 에러 5개 이상 시 알림
2. **DynamoDB 스로틀링 알람**
   - 읽기/쓰기 스로틀링 발생 시 알림
3. **API Gateway 4xx/5xx 알람**
   - 에러율 10% 이상 시 알림

### 로그 설정
- Lambda 함수별 로그 그룹 생성
- 로그 보존 기간: 7일 (비용 절약)

## 🚀 배포 전략

### 환경 구성
- **개발환경**: `dev`
- **운영환경**: `prod` (해커톤 후)

### 배포 스크립트
```bash
# scripts/deploy.sh
#!/bin/bash
set -e

echo "🚀 LiveInsight 인프라 배포 시작..."

# Terraform 초기화
cd terraform
terraform init

# 배포 계획 확인
terraform plan

# 인프라 배포
terraform apply -auto-approve

# 출력값 표시
echo "✅ 배포 완료!"
echo "API URL: $(terraform output -raw api_gateway_url)"
echo "Dashboard URL: $(terraform output -raw cloudfront_url)"
```

## ⚠️ 주의사항 및 리스크 대응

### 기술적 리스크 및 대응방안
1. **DynamoDB 설계 변경**
   - **리스크**: 담당자 B 요구사항 변경
   - **대응**: Phase 1 완료 전 스키마 최종 확정 (2시간 내)
   - **롤백**: 기본 스키마로 복구 후 Phase 2에서 마이그레이션

2. **Lambda 배포 실패**
   - **리스크**: 코드 패키징, 권한 문제
   - **대응**: 더미 Lambda 함수로 인프라 먼저 검증
   - **롤백**: 이전 버전 Lambda 함수로 즉시 복구

3. **API Gateway CORS 이슈**
   - **리스크**: 브라우저 CORS 에러
   - **대응**: 와일드카드(*) 허용으로 우선 해결
   - **롤백**: 기본 CORS 설정으로 복구

4. **Terraform 상태 충돌**
   - **리스크**: 동시 배포 시 상태 파일 충돌
   - **대응**: S3 백엔드 + DynamoDB 락 설정
   - **롤백**: 로컬 상태 파일로 임시 복구

### 단계별 롤백 계획
- **Phase 1 실패**: 기본 DynamoDB 테이블만 유지
- **Phase 2 실패**: Lambda 없이 API Gateway 테스트
- **Phase 3 실패**: 모니터링 없이 기본 기능 우선

## 🤝 담당자 B와의 협업 포인트

### 인터페이스 정의
1. **환경변수 규칙**
   - `EVENTS_TABLE`, `SESSIONS_TABLE` 사용
2. **API 엔드포인트**
   - `/api/events`, `/api/realtime`, `/api/stats`
3. **DynamoDB 스키마**
   - 변경 시 사전 협의 필수

### 작업 순서 및 체크포인트
1. **Phase 1 완료 시 (4시간)**
   - A: DynamoDB + IAM 완료 → B: 로컬 개발 시작
   - 체크포인트: 스키마 최종 확정, 환경변수 합의

2. **Phase 2 중간 (8시간)**
   - A: Lambda 배포 환경 → B: 코드 배포 테스트
   - 체크포인트: API 엔드포인트 연결 확인

3. **Phase 2 완료 시 (12시간)**
   - A: API Gateway 연결 → B: 통합 테스트
   - 체크포인트: 전체 API 동작 검증

### 협의 시점 및 결정 기준
- **2시간 후**: DynamoDB 스키마 최종 확정 (변경 불가)
- **6시간 후**: API 엔드포인트 경로 확정 (변경 불가)
- **10시간 후**: Lambda 핸들러 경로 확정 (변경 불가)

## 📈 성공 지표

### 기술적 목표
- [x] 모든 AWS 리소스 정상 배포 (48개 리소스)
- [x] API 응답시간 < 100ms (더미 응답 기준)
- [x] 에러율 < 1% (모니터링 알람 설정)
- [x] 배포 자동화 완성 (scripts/deploy.sh)

### 비즈니스 목표
- [x] 담당자 B 개발 환경 지원 완료
- [x] 데모 환경 구축 완료
- [x] 실시간 모니터링 가능

## 🎉 Phase 1-2 완료 성과 + 보안 강화 (최신 업데이트)
- **배포된 리소스**: 59개 AWS 리소스 (목표 대비 123% 달성)
- **API Gateway**: 3개 엔드포인트 + CORS 설정 완료
- **Lambda 함수**: 3개 배포 완료 (더미 코드, 실제 코드 배포 준비)
- **모니터링**: 8개 CloudWatch 알람 + 4개 로그 그룹
- **정적 파일**: S3 + CloudFront 글로벌 CDN 배포
- **보안 강화**: CSRF 토큰, 입력 검증, S3 보안 설정 완료
- **코드 최적화**: Terraform 중복 제거 (135줄 감소)
- **문서화**: 배포 가이드 및 리소스 관리 문서 완성
- **배포 URL**: API, Dashboard 모두 접근 가능한 상태

이 계획에 따라 체계적으로 인프라를 구축하여 성공적인 해커톤 완주를 목표로 합니다! 🎯