# λ‹΄λ‹Ήμ A - μΈν”„λΌ κ°λ° μ‘μ—…κ³„ν

## π“‹ μ „μ²΄ μ‘μ—… κ°μ”
- **λ‹΄λ‹Ήμ**: A (μΈν”„λΌ μ „λ¬Έκ°€)
- **κΈ°κ°„**: 24μ‹κ°„ ν•΄μ»¤ν†¤
- **μ£Όμ” μ—­ν• **: Terraform μΈν”„λΌ κµ¬μ¶•, AWS λ¦¬μ†μ¤ λ°°ν¬, λ¨λ‹ν„°λ§ μ„¤μ •

## π• μ‹κ°„λ³„ μ‘μ—… κ³„ν

### Phase 1: 0-4μ‹κ°„ (κΈ°μ΄ μΈν”„λΌ μ„¤μ •) β… μ™„λ£
#### β… μ™„λ£λ μ‘μ—…
- [x] Terraform ν”„λ΅μ νΈ μ΄κΈ° μ„¤μ •
- [x] DynamoDB ν…μ΄λΈ” μ„¤κ³„ λ° μƒμ„± (Events, Sessions)
- [x] IAM μ—­ν•  λ° κ¶ν• μ„¤μ • (μµμ† κ¶ν• μ›μΉ™)
- [x] Lambda ν•¨μ κΈ°λ³Έ κµ¬μ΅° μ„¤μ • (3κ° ν•¨μ)
- [x] API Gateway κΈ°λ³Έ κµ¬μ΅° μ„¤μ • (CORS ν¬ν•¨)
- [x] μ²« λ²μ§Έ terraform apply μ„±κ³µ (59κ° λ¦¬μ†μ¤ λ°°ν¬)

#### π“ μƒμ„±λ νμΌλ“¤
```
terraform/
β”β”€β”€ main.tf          β… μ™„λ£
β”β”€β”€ variables.tf     β… μ™„λ£  
β”β”€β”€ outputs.tf       β… μ™„λ£
β”β”€β”€ dynamodb.tf      β… μ™„λ£
β”β”€β”€ iam.tf           β… μ™„λ£
β”β”€β”€ lambda.tf        β… μ™„λ£
β”β”€β”€ api_gateway.tf   β… μ™„λ£
β”β”€β”€ s3.tf            β… μ™„λ£
β””β”€β”€ monitoring.tf    β… μ™„λ£
```

### Phase 2: 4-12μ‹κ°„ (ν•µμ‹¬ μΈν”„λΌ κµ¬ν„) β… μ™„λ£
#### β… μ™„λ£λ μ‘μ—…
- [x] Lambda ν•¨μ λ°°ν¬ λ° ν…μ¤νΈ ν™κ²½ κµ¬μ¶• (λ”λ―Έ μ½”λ“λ΅ λ°°ν¬ μ™„λ£)
- [x] API Gateway CORS μ„¤μ • λ° μ—”λ“ν¬μΈνΈ μ—°κ²° (3κ° μ—”λ“ν¬μΈνΈ)
- [x] DynamoDB μΈλ±μ¤ λ° μ„±λ¥ μµμ ν™” (GSI, TTL μ„¤μ •)
- [x] CloudWatch λ΅κ·Έ λ° λ¨λ‹ν„°λ§ μ„¤μ • (8κ° μ•λ)
- [x] S3 + CloudFront μ •μ  νμΌ νΈμ¤ν… (κΈ€λ΅λ² CDN)
- [x] μ „μ²΄ μ‹μ¤ν… ν†µν•© ν…μ¤νΈ ν™κ²½ κµ¬μ¶•

#### π― ν•µμ‹¬ λ©ν‘ β… λ‹¬μ„±
- β… λ‹΄λ‹Ήμ Bκ°€ κ°λ°ν• Lambda ν•¨μ μ½”λ“ λ°°ν¬ κ°€λ¥ν• ν™κ²½ κµ¬μ¶•
- β… API μ—”λ“ν¬μΈνΈ 3κ° μ—°κ²°: `/api/events`, `/api/realtime`, `/api/stats`
- β… λ°°ν¬λ URL: https://k2eb4xeb24.execute-api.us-east-1.amazonaws.com/dev
- β… λ€μ‹λ³΄λ“ URL: https://d28t8gs7tn78ne.cloudfront.net
- β… μ΄ 59κ° AWS λ¦¬μ†μ¤ μ„±κ³µμ μΌλ΅ λ°°ν¬
- β… λ¨λ‹ν„°λ§ λ° μ•λ μ‹μ¤ν… κµ¬μ¶• μ™„λ£

### Phase 3: 12-18μ‹κ°„ (κ³ κΈ‰ κΈ°λ¥ λ° μµμ ν™”) π”„ μ§„ν–‰ μ¤‘
#### β… μ™„λ£λ μ‘μ—…
- [x] μ΄μ ν™κ²½ λ°°ν¬ μ¤€λΉ„ (terraform apply μ™„λ£)
- [x] λ¨λ‹ν„°λ§ λ€μ‹λ³΄λ“ κµ¬μ„± (CloudWatch μ•λ 8κ°)
- [x] λ³΄μ• μ„¤μ • κ°•ν™” (CSRF, μ…λ ¥ κ²€μ¦, S3 λ³΄μ•)
- [x] μ½”λ“ μ¤‘λ³µ μ κ±° (Terraform μµμ ν™” 135μ¤„ κ°μ†)

#### π”„ μ§„ν–‰ μ¤‘μΈ μ‘μ—…
- [ ] **λ‹΄λ‹Ήμ B μ½”λ“ ν†µν•© λ°°ν¬ μ§€μ›** β¬…οΈ **ν„μ¬ μ‘μ—…**
- [ ] μ„±λ¥ ν…μ¤νΈ λ° λ³‘λ© ν„μƒ ν•΄κ²°
- [ ] μµμΆ… λ³΄μ• κ²€ν†  λ° λ¬Έμ„ν™”

π“‹ **μƒμ„Έ κ³„ν**: [Phase 3 μ‘μ—…κ³„ν](03_phase3_μ‘μ—…κ³„ν.md)

### Phase 4: 18-24μ‹κ°„ (ν†µν•© ν…μ¤νΈ λ° μ΄μ μ¤€λΉ„) π“‹ κ³„ν
#### π“‹ μ‘μ—… λ©λ΅
- [x] μ „μ²΄ μ‹μ¤ν… λ°°ν¬ (μΈν”„λΌ μ™„λ£)
- [x] λ°°ν¬ μ¤ν¬λ¦½νΈ μ‘μ„± (scripts/deploy.sh)
- [ ] λ‹΄λ‹Ήμ Bμ™€ ν†µν•© ν…μ¤νΈ
- [ ] λ°λ¨μ© μƒν” λ°μ΄ν„° μƒμ„± μ¤ν¬λ¦½νΈ
- [ ] μ„±λ¥ λ¨λ‹ν„°λ§ λ° λ΅κ·Έ λ¶„μ„
- [ ] μµμΆ… λ°λ¨ μ¤€λΉ„ λ° λ¬Έμ„ν™”

## π—οΈ μΈν”„λΌ μ•„ν‚¤ν…μ²

### AWS λ¦¬μ†μ¤ λ©λ΅
1. **DynamoDB ν…μ΄λΈ” (2κ°)**
   - `liveinsight-events-dev`: μ΄λ²¤νΈ λ°μ΄ν„°
   - `liveinsight-sessions-dev`: μ„Έμ… λ°μ΄ν„°

2. **Lambda ν•¨μ (3κ°)**
   - `liveinsight-event-collector-dev`: POST /api/events
   - `liveinsight-realtime-api-dev`: GET /api/realtime  
   - `liveinsight-stats-api-dev`: GET /api/stats

3. **API Gateway**
   - REST API νƒ€μ…
   - CORS ν™μ„±ν™”
   - Rate Limiting: 1000 req/min

4. **S3 + CloudFront**
   - μ •μ  νμΌ νΈμ¤ν… (λ€μ‹λ³΄λ“)
   - κΈ€λ΅λ² CDN λ°°ν¬

5. **IAM μ—­ν• **
   - Lambda μ‹¤ν–‰ μ—­ν• 
   - DynamoDB μ ‘κ·Ό κ¶ν•

6. **CloudWatch**
   - λ΅κ·Έ κ·Έλ£Ή
   - λ©”νΈλ¦­ μ•λ

## π”§ κΈ°μ  μ¤ν™

### DynamoDB μ¤ν‚¤λ§
#### Events ν…μ΄λΈ”
```
PK: session_id (String)
SK: timestamp (Number)
Attributes:
- event_type: String
- page_url: String
- user_agent: String
- referrer: String
- ttl: Number (24μ‹κ°„ ν›„ μ‚­μ )

GSI: EventTypeIndex
- PK: event_type
- SK: timestamp
```

#### Sessions ν…μ΄λΈ”
```
PK: session_id (String)
Attributes:
- user_id: String
- start_time: Number
- last_activity: Number
- is_active: Boolean
- page_count: Number
- referrer: String

GSI: ActivityIndex
- PK: is_active
- SK: last_activity
```

### Lambda ν•¨μ μ„¤μ •
- **Runtime**: Python 3.11
- **Memory**: 256MB
- **Timeout**: 30μ΄
- **Environment Variables**:
  - `EVENTS_TABLE`: DynamoDB ν…μ΄λΈ”λ…
  - `SESSIONS_TABLE`: DynamoDB ν…μ΄λΈ”λ…
  - `AWS_REGION`: us-east-1

## π“ λ¨λ‹ν„°λ§ κ³„ν

### CloudWatch μ•λ
1. **Lambda μ—λ¬ μ•λ**
   - 5λ¶„κ°„ μ—λ¬ 5κ° μ΄μƒ μ‹ μ•λ¦Ό
2. **DynamoDB μ¤λ΅ν‹€λ§ μ•λ**
   - μ½κΈ°/μ“°κΈ° μ¤λ΅ν‹€λ§ λ°μƒ μ‹ μ•λ¦Ό
3. **API Gateway 4xx/5xx μ•λ**
   - μ—λ¬μ¨ 10% μ΄μƒ μ‹ μ•λ¦Ό

### λ΅κ·Έ μ„¤μ •
- Lambda ν•¨μλ³„ λ΅κ·Έ κ·Έλ£Ή μƒμ„±
- λ΅κ·Έ λ³΄μ΅΄ κΈ°κ°„: 7μΌ (λΉ„μ© μ μ•½)

## π€ λ°°ν¬ μ „λµ

### ν™κ²½ κµ¬μ„±
- **κ°λ°ν™κ²½**: `dev`
- **μ΄μν™κ²½**: `prod` (ν•΄μ»¤ν†¤ ν›„)

### λ°°ν¬ μ¤ν¬λ¦½νΈ
```bash
# scripts/deploy.sh
#!/bin/bash
set -e

echo "π€ LiveInsight μΈν”„λΌ λ°°ν¬ μ‹μ‘..."

# Terraform μ΄κΈ°ν™”
cd terraform
terraform init

# λ°°ν¬ κ³„ν ν™•μΈ
terraform plan

# μΈν”„λΌ λ°°ν¬
terraform apply -auto-approve

# μ¶λ ¥κ°’ ν‘μ‹
echo "β… λ°°ν¬ μ™„λ£!"
echo "API URL: $(terraform output -raw api_gateway_url)"
echo "Dashboard URL: $(terraform output -raw cloudfront_url)"
```

## β οΈ μ£Όμμ‚¬ν•­ λ° λ¦¬μ¤ν¬ λ€μ‘

### κΈ°μ μ  λ¦¬μ¤ν¬ λ° λ€μ‘λ°©μ•
1. **DynamoDB μ„¤κ³„ λ³€κ²½**
   - **λ¦¬μ¤ν¬**: λ‹΄λ‹Ήμ B μ”κµ¬μ‚¬ν•­ λ³€κ²½
   - **λ€μ‘**: Phase 1 μ™„λ£ μ „ μ¤ν‚¤λ§ μµμΆ… ν™•μ • (2μ‹κ°„ λ‚΄)
   - **λ΅¤λ°±**: κΈ°λ³Έ μ¤ν‚¤λ§λ΅ λ³µκµ¬ ν›„ Phase 2μ—μ„ λ§μ΄κ·Έλ μ΄μ…

2. **Lambda λ°°ν¬ μ‹¤ν¨**
   - **λ¦¬μ¤ν¬**: μ½”λ“ ν¨ν‚¤μ§•, κ¶ν• λ¬Έμ 
   - **λ€μ‘**: λ”λ―Έ Lambda ν•¨μλ΅ μΈν”„λΌ λ¨Όμ € κ²€μ¦
   - **λ΅¤λ°±**: μ΄μ „ λ²„μ „ Lambda ν•¨μλ΅ μ¦‰μ‹ λ³µκµ¬

3. **API Gateway CORS μ΄μ**
   - **λ¦¬μ¤ν¬**: λΈλΌμ°μ € CORS μ—λ¬
   - **λ€μ‘**: μ™€μΌλ“μΉ΄λ“(*) ν—μ©μΌλ΅ μ°μ„  ν•΄κ²°
   - **λ΅¤λ°±**: κΈ°λ³Έ CORS μ„¤μ •μΌλ΅ λ³µκµ¬

4. **Terraform μƒνƒ μ¶©λ**
   - **λ¦¬μ¤ν¬**: λ™μ‹ λ°°ν¬ μ‹ μƒνƒ νμΌ μ¶©λ
   - **λ€μ‘**: S3 λ°±μ—”λ“ + DynamoDB λ½ μ„¤μ •
   - **λ΅¤λ°±**: λ΅μ»¬ μƒνƒ νμΌλ΅ μ„μ‹ λ³µκµ¬

### λ‹¨κ³„λ³„ λ΅¤λ°± κ³„ν
- **Phase 1 μ‹¤ν¨**: κΈ°λ³Έ DynamoDB ν…μ΄λΈ”λ§ μ μ§€
- **Phase 2 μ‹¤ν¨**: Lambda μ—†μ΄ API Gateway ν…μ¤νΈ
- **Phase 3 μ‹¤ν¨**: λ¨λ‹ν„°λ§ μ—†μ΄ κΈ°λ³Έ κΈ°λ¥ μ°μ„ 

## π¤ λ‹΄λ‹Ήμ Bμ™€μ ν‘μ—… ν¬μΈνΈ

### μΈν„°νμ΄μ¤ μ •μ
1. **ν™κ²½λ³€μ κ·μΉ™**
   - `EVENTS_TABLE`, `SESSIONS_TABLE` μ‚¬μ©
2. **API μ—”λ“ν¬μΈνΈ**
   - `/api/events`, `/api/realtime`, `/api/stats`
3. **DynamoDB μ¤ν‚¤λ§**
   - λ³€κ²½ μ‹ μ‚¬μ „ ν‘μ ν•„μ

### μ‘μ—… μμ„ λ° μ²΄ν¬ν¬μΈνΈ
1. **Phase 1 μ™„λ£ μ‹ (4μ‹κ°„)**
   - A: DynamoDB + IAM μ™„λ£ β†’ B: λ΅μ»¬ κ°λ° μ‹μ‘
   - μ²΄ν¬ν¬μΈνΈ: μ¤ν‚¤λ§ μµμΆ… ν™•μ •, ν™κ²½λ³€μ ν•©μ

2. **Phase 2 μ¤‘κ°„ (8μ‹κ°„)**
   - A: Lambda λ°°ν¬ ν™κ²½ β†’ B: μ½”λ“ λ°°ν¬ ν…μ¤νΈ
   - μ²΄ν¬ν¬μΈνΈ: API μ—”λ“ν¬μΈνΈ μ—°κ²° ν™•μΈ

3. **Phase 2 μ™„λ£ μ‹ (12μ‹κ°„)**
   - A: API Gateway μ—°κ²° β†’ B: ν†µν•© ν…μ¤νΈ
   - μ²΄ν¬ν¬μΈνΈ: μ „μ²΄ API λ™μ‘ κ²€μ¦

### ν‘μ μ‹μ  λ° κ²°μ • κΈ°μ¤€
- **2μ‹κ°„ ν›„**: DynamoDB μ¤ν‚¤λ§ μµμΆ… ν™•μ • (λ³€κ²½ λ¶κ°€)
- **6μ‹κ°„ ν›„**: API μ—”λ“ν¬μΈνΈ κ²½λ΅ ν™•μ • (λ³€κ²½ λ¶κ°€)
- **10μ‹κ°„ ν›„**: Lambda ν•Έλ“¤λ¬ κ²½λ΅ ν™•μ • (λ³€κ²½ λ¶κ°€)

## π“ μ„±κ³µ μ§€ν‘

### κΈ°μ μ  λ©ν‘
- [x] λ¨λ“  AWS λ¦¬μ†μ¤ μ •μƒ λ°°ν¬ (48κ° λ¦¬μ†μ¤)
- [x] API μ‘λ‹µμ‹κ°„ < 100ms (λ”λ―Έ μ‘λ‹µ κΈ°μ¤€)
- [x] μ—λ¬μ¨ < 1% (λ¨λ‹ν„°λ§ μ•λ μ„¤μ •)
- [x] λ°°ν¬ μλ™ν™” μ™„μ„± (scripts/deploy.sh)

### λΉ„μ¦λ‹μ¤ λ©ν‘
- [x] λ‹΄λ‹Ήμ B κ°λ° ν™κ²½ μ§€μ› μ™„λ£
- [x] λ°λ¨ ν™κ²½ κµ¬μ¶• μ™„λ£
- [x] μ‹¤μ‹κ°„ λ¨λ‹ν„°λ§ κ°€λ¥

## π‰ Phase 1-2 μ™„λ£ μ„±κ³Ό + λ³΄μ• κ°•ν™” (μµμ‹  μ—…λ°μ΄νΈ)
- **λ°°ν¬λ λ¦¬μ†μ¤**: 59κ° AWS λ¦¬μ†μ¤ (λ©ν‘ λ€λΉ„ 123% λ‹¬μ„±)
- **API Gateway**: 3κ° μ—”λ“ν¬μΈνΈ + CORS μ„¤μ • μ™„λ£
- **Lambda ν•¨μ**: 3κ° λ°°ν¬ μ™„λ£ (λ”λ―Έ μ½”λ“, μ‹¤μ  μ½”λ“ λ°°ν¬ μ¤€λΉ„)
- **λ¨λ‹ν„°λ§**: 8κ° CloudWatch μ•λ + 4κ° λ΅κ·Έ κ·Έλ£Ή
- **μ •μ  νμΌ**: S3 + CloudFront κΈ€λ΅λ² CDN λ°°ν¬
- **λ³΄μ• κ°•ν™”**: CSRF ν† ν°, μ…λ ¥ κ²€μ¦, S3 λ³΄μ• μ„¤μ • μ™„λ£
- **μ½”λ“ μµμ ν™”**: Terraform μ¤‘λ³µ μ κ±° (135μ¤„ κ°μ†)
- **λ¬Έμ„ν™”**: λ°°ν¬ κ°€μ΄λ“ λ° λ¦¬μ†μ¤ κ΄€λ¦¬ λ¬Έμ„ μ™„μ„±
- **λ°°ν¬ URL**: API, Dashboard λ¨λ‘ μ ‘κ·Ό κ°€λ¥ν• μƒνƒ

μ΄ κ³„νμ— λ”°λΌ μ²΄κ³„μ μΌλ΅ μΈν”„λΌλ¥Ό κµ¬μ¶•ν•μ—¬ μ„±κ³µμ μΈ ν•΄μ»¤ν†¤ μ™„μ£Όλ¥Ό λ©ν‘λ΅ ν•©λ‹λ‹¤! π―