# LiveInsight ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ìƒì„¸ ë¬¸ì„œ

## ğŸ“Š ì‹œìŠ¤í…œ ê°œìš”

LiveInsightëŠ” ì‹¤ì‹œê°„ ì›¹ ë¶„ì„ í”Œë«í¼ìœ¼ë¡œ, ì›¹ì‚¬ì´íŠ¸ ë°©ë¬¸ìì˜ í–‰ë™ì„ ì‹¤ì‹œê°„ìœ¼ë¡œ ì¶”ì í•˜ê³  ë¶„ì„í•˜ì—¬ ë¹„ì¦ˆë‹ˆìŠ¤ ì¸ì‚¬ì´íŠ¸ë¥¼ ì œê³µí•©ë‹ˆë‹¤.

## ğŸ—ï¸ ë°ì´í„° ì•„í‚¤í…ì²˜

### ë°ì´í„° íë¦„ë„
```
ì›¹ì‚¬ì´íŠ¸ ë°©ë¬¸ì
    â†“ (JavaScript SDK)
API Gateway + Lambda
    â†“ (ì´ë²¤íŠ¸ ì²˜ë¦¬)
DynamoDB (3ê°œ í…Œì´ë¸”)
    â†“ (ì‹¤ì‹œê°„ ì¡°íšŒ)
Django REST API
    â†“ (ì‹œê°í™”)
ì‹¤ì‹œê°„ ëŒ€ì‹œë³´ë“œ
```

### í•µì‹¬ ë°ì´í„° ëª¨ë¸

#### 1. Events í…Œì´ë¸” (ì´ë²¤íŠ¸ ì €ì¥ì†Œ)
```json
{
  "event_id": "evt_20241201_123456_abc123",     // Primary Key
  "timestamp": 1701432000000,                   // Sort Key (ë°€ë¦¬ì´ˆ)
  "user_id": "user_abc123",                     // ì˜êµ¬ ì‚¬ìš©ì ì‹ë³„ì
  "session_id": "sess_20241201_abc123",         // ì„¸ì…˜ ì‹ë³„ì
  "event_type": "page_view",                    // ì´ë²¤íŠ¸ íƒ€ì…
  "page_url": "/products/item1",                // í˜ì´ì§€ URL
  "referrer": "https://google.com",             // ìœ ì… ê²½ë¡œ
  "user_agent": "Mozilla/5.0...",               // ë¸Œë¼ìš°ì € ì •ë³´
  "ip_address": "192.168.1.1"                  // í´ë¼ì´ì–¸íŠ¸ IP
}
```

**ì´ë²¤íŠ¸ íƒ€ì…:**
- `page_view`: í˜ì´ì§€ ì¡°íšŒ
- `click`: ë²„íŠ¼/ë§í¬ í´ë¦­
- `conversion`: ì „í™˜ ì´ë²¤íŠ¸
- `heartbeat`: í™œì„± ìƒíƒœ ìœ ì§€ (30ì´ˆë§ˆë‹¤)

#### 2. Sessions í…Œì´ë¸” (ì„¸ì…˜ ë©”íƒ€ë°ì´í„°)
```json
{
  "session_id": "sess_20241201_abc123",         // Primary Key
  "user_id": "user_abc123",                     // ì‚¬ìš©ì ì‹ë³„ì
  "start_time": 1701432000000,                  // ì„¸ì…˜ ì‹œì‘ ì‹œê°„
  "last_activity": 1701433800000,               // ë§ˆì§€ë§‰ í™œë™ ì‹œê°„
  "is_active": true,                            // í™œì„± ìƒíƒœ
  "entry_page": "/home",                        // ì§„ì… í˜ì´ì§€
  "exit_page": "/products/item1",               // ì´íƒˆ í˜ì´ì§€
  "referrer": "https://google.com",             // ìœ ì… ê²½ë¡œ
  "total_events": 15,                           // ì´ ì´ë²¤íŠ¸ ìˆ˜
  "session_duration": 1800                      // ì„¸ì…˜ ì§€ì† ì‹œê°„(ì´ˆ)
}
```

#### 3. ActiveSessions í…Œì´ë¸” (ì‹¤ì‹œê°„ í™œì„± ì„¸ì…˜)
```json
{
  "session_id": "sess_20241201_abc123",         // Primary Key
  "user_id": "user_abc123",                     // ì‚¬ìš©ì ì‹ë³„ì
  "last_activity": 1701433800000,               // ë§ˆì§€ë§‰ í™œë™
  "current_page": "/products/item1",            // í˜„ì¬ í˜ì´ì§€
  "expires_at": 1701435600                      // TTL (30ë¶„ í›„ ìë™ ì‚­ì œ)
}
```

## ğŸ”„ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ìƒì„¸

### 1. ë°ì´í„° ìˆ˜ì§‘ í”„ë¡œì„¸ìŠ¤

#### JavaScript SDK ë™ì‘ íë¦„
```javascript
// 1. ì‚¬ìš©ì ì‹ë³„ì ìƒì„±/ì¡°íšŒ
getUserId() {
    let userId = localStorage.getItem('li_user_id');
    if (!userId) {
        userId = 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        localStorage.setItem('li_user_id', userId);  // ì˜êµ¬ ì €ì¥
    }
    return userId;
}

// 2. ì„¸ì…˜ ì‹ë³„ì ìƒì„±/ì¡°íšŒ
getSessionId() {
    let sessionId = sessionStorage.getItem('li_session_id');
    if (!sessionId) {
        sessionId = 'sess_' + Date.now() + '_' + this.userId.substr(-8);
        sessionStorage.setItem('li_session_id', sessionId);  // ë¸Œë¼ìš°ì € ì„¸ì…˜ ë™ì•ˆë§Œ
    }
    return sessionId;
}
```

#### ì´ë²¤íŠ¸ ìˆ˜ì§‘ ì‹œë‚˜ë¦¬ì˜¤
1. **í˜ì´ì§€ ë¡œë“œ**: ìë™ìœ¼ë¡œ `page_view` ì´ë²¤íŠ¸ ë°œìƒ
2. **ì‚¬ìš©ì ìƒí˜¸ì‘ìš©**: ë²„íŠ¼/ë§í¬ í´ë¦­ ì‹œ `click` ì´ë²¤íŠ¸ ë°œìƒ
3. **ì „í™˜ ì¶”ì **: ê°œë°œìê°€ ìˆ˜ë™ìœ¼ë¡œ `conversion` ì´ë²¤íŠ¸ í˜¸ì¶œ
4. **í™œì„± ìƒíƒœ ìœ ì§€**: 30ì´ˆë§ˆë‹¤ `heartbeat` ì´ë²¤íŠ¸ ìë™ ë°œìƒ

### 2. ì„œë²„ë¦¬ìŠ¤ ë°ì´í„° ì²˜ë¦¬

#### Lambda í•¨ìˆ˜ ì²˜ë¦¬ ë¡œì§
```python
def lambda_handler(event, context):
    # 1. ì´ë²¤íŠ¸ ë°ì´í„° ìƒì„±
    event_data = create_event_data(body, event)
    
    # 2. ì„¸ì…˜ ê´€ë¦¬ (ì‹ ê·œ ìƒì„± ë˜ëŠ” ê¸°ì¡´ ì—…ë°ì´íŠ¸)
    session_data = manage_session(event_data)
    
    # 3. ë°ì´í„° ì €ì¥ (3ê°œ í…Œì´ë¸”)
    save_event_data(event_data, session_data)
    
    # 4. CloudWatch ë©”íŠ¸ë¦­ ì „ì†¡
    put_custom_metric('EventsProcessed', 1)
```

#### ì„¸ì…˜ ìƒëª…ì£¼ê¸° ê´€ë¦¬
```
ìƒˆ ë°©ë¬¸ì â†’ ìƒˆ ì„¸ì…˜ ìƒì„± â†’ ì´ë²¤íŠ¸ ë°œìƒ â†’ ì„¸ì…˜ ì—…ë°ì´íŠ¸ â†’ 30ë¶„ ë¹„í™œì„± â†’ ì„¸ì…˜ ë§Œë£Œ
```

### 3. ì‹¤ì‹œê°„ ë¶„ì„ API

#### ì£¼ìš” API ì—”ë“œí¬ì¸íŠ¸
```python
# í™œì„± ì„¸ì…˜ ì¡°íšŒ (30ì´ˆ ìºì‹œ)
GET /api/sessions/active/
â†’ ActiveSessions í…Œì´ë¸” ìŠ¤ìº”

# ì‹œê°„ëŒ€ë³„ í†µê³„ (5ë¶„ ë‹¨ìœ„, ìµœê·¼ 100ë¶„)
GET /api/statistics/hourly/
â†’ Events í…Œì´ë¸” ì‹œê°„ ë²”ìœ„ ì¿¼ë¦¬

# í˜ì´ì§€ë³„ í†µê³„
GET /api/statistics/pages/
â†’ Events í…Œì´ë¸”ì—ì„œ page_view ì´ë²¤íŠ¸ ì§‘ê³„

# ìœ ì…ê²½ë¡œë³„ í†µê³„
GET /api/statistics/referrers/
â†’ Events í…Œì´ë¸”ì—ì„œ referrer ë¶„ì„
```

#### ë°ì´í„° ì§‘ê³„ ë¡œì§
```python
def aggregate_by_hour(self, events):
    # ìµœê·¼ 100ë¶„ì„ 5ë¶„ ë‹¨ìœ„ë¡œ ë‚˜ëˆ„ì–´ 20ê°œ í¬ì¸íŠ¸ ìƒì„±
    for i in range(20):
        time_point = now - timedelta(minutes=(19 - i) * 5)
        time_key = time_point.strftime('%H:%M')
        hourly_counts[time_key] = 0
    
    # ì‹¤ì œ ì´ë²¤íŠ¸ë¡œ ì¹´ìš´íŠ¸ ì—…ë°ì´íŠ¸
    for event in events:
        # 5ë¶„ ë‹¨ìœ„ë¡œ ë°˜ì˜¬ë¦¼í•˜ì—¬ ì§‘ê³„
        minute_slot = (event_time.minute // 5) * 5
        event_rounded = event_time.replace(minute=minute_slot)
        hourly_counts[time_key] += 1
```

## ğŸ“ˆ ëŒ€ì‹œë³´ë“œ ê¸°ëŠ¥

### ì‹¤ì‹œê°„ ì§€í‘œ
1. **í˜„ì¬ í™œì„± ì‚¬ìš©ì**: ActiveSessions í…Œì´ë¸” ì¹´ìš´íŠ¸
2. **ì´ ì´ë²¤íŠ¸ ìˆ˜**: Events í…Œì´ë¸” ì¹´ìš´íŠ¸ (ìµœê·¼ 24ì‹œê°„)
3. **í‰ê·  ì„¸ì…˜ ì‹œê°„**: í™œì„± ì„¸ì…˜ë“¤ì˜ í‰ê·  ì§€ì† ì‹œê°„
4. **ì „í™˜ìœ¨**: conversion ì´ë²¤íŠ¸ / ì´ ì´ë²¤íŠ¸ ë¹„ìœ¨

### ì‹œê°í™” ì°¨íŠ¸
1. **ì‹œê°„ëŒ€ë³„ íŠ¸ë˜í”½**: Line Chart (Chart.js)
2. **í˜ì´ì§€ë³„ ì¡°íšŒìˆ˜**: Bar Chart
3. **ìœ ì…ê²½ë¡œ ë¶„í¬**: Pie Chart
4. **ì‹¤ì‹œê°„ í™œì„± ì„¸ì…˜**: Table with Auto-refresh

## ğŸ” ë°ì´í„° ì ‘ê·¼ íŒ¨í„´

### DynamoDB ì¸ë±ìŠ¤ ì„¤ê³„
```
Primary Table: Events
â”œâ”€â”€ Primary Key: event_id
â”œâ”€â”€ Sort Key: timestamp
â”œâ”€â”€ GSI-1: user_id + timestamp (ì‚¬ìš©ìë³„ ì´ë²¤íŠ¸ ì¡°íšŒ)
â””â”€â”€ GSI-2: session_id + timestamp (ì„¸ì…˜ë³„ ì´ë²¤íŠ¸ ì¡°íšŒ)

Primary Table: Sessions  
â”œâ”€â”€ Primary Key: session_id
â””â”€â”€ GSI-1: user_id + start_time (ì‚¬ìš©ìë³„ ì„¸ì…˜ íˆìŠ¤í† ë¦¬)

Primary Table: ActiveSessions
â”œâ”€â”€ Primary Key: session_id
â””â”€â”€ TTL: expires_at (30ë¶„ ìë™ ë§Œë£Œ)
```

### ì¿¼ë¦¬ ìµœì í™”
1. **ì‹¤ì‹œê°„ ì¡°íšŒ**: ActiveSessions ìŠ¤ìº” (ì†ŒëŸ‰ ë°ì´í„°)
2. **ì‹œê°„ ë²”ìœ„ ì¡°íšŒ**: Events í…Œì´ë¸” timestamp í•„í„°
3. **ì‚¬ìš©ìë³„ ì¡°íšŒ**: GSI-1 í™œìš©
4. **ì„¸ì…˜ë³„ ì¡°íšŒ**: GSI-2 í™œìš©

## ğŸš€ ì„±ëŠ¥ ìµœì í™”

### ìºì‹± ì „ëµ
```python
# í™œì„± ì„¸ì…˜ 30ì´ˆ ìºì‹œ
@cache_page(30)
def active_sessions():
    return db_client.get_active_sessions()
```

### ë°°ì¹˜ ì²˜ë¦¬
- Lambda ë™ì‹œ ì‹¤í–‰ìœ¼ë¡œ ë†’ì€ ì²˜ë¦¬ëŸ‰ ì§€ì›
- DynamoDB Auto Scalingìœ¼ë¡œ íŠ¸ë˜í”½ ê¸‰ì¦ ëŒ€ì‘
- CloudWatch ë©”íŠ¸ë¦­ìœ¼ë¡œ ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§

## ğŸ“Š ë¹„ì¦ˆë‹ˆìŠ¤ ì¸ì‚¬ì´íŠ¸

### ì œê³µí•˜ëŠ” ë¶„ì„ ë°ì´í„°
1. **ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§**: í˜„ì¬ ì ‘ì†ì, ì‹¤ì‹œê°„ í˜ì´ì§€ë·°
2. **ì‚¬ìš©ì í–‰ë™ ë¶„ì„**: í˜ì´ì§€ë³„ ì²´ë¥˜ì‹œê°„, í´ë¦­ íŒ¨í„´
3. **ìœ ì… ê²½ë¡œ ë¶„ì„**: íŠ¸ë˜í”½ ì†ŒìŠ¤ë³„ ì„±ê³¼ ì¸¡ì •
4. **ì „í™˜ ë¶„ì„**: ëª©í‘œ ë‹¬ì„±ë¥ , í¼ë„ ë¶„ì„
5. **ì„¸ì…˜ ë¶„ì„**: í‰ê·  ì„¸ì…˜ ì‹œê°„, í˜ì´ì§€ë·° ìˆ˜

### í™œìš© ì‚¬ë¡€
- **E-commerce**: ìƒí’ˆ í˜ì´ì§€ ì„±ê³¼, êµ¬ë§¤ ì „í™˜ìœ¨
- **ë¯¸ë””ì–´**: ì½˜í…ì¸  ì¸ê¸°ë„, ì‚¬ìš©ì ì°¸ì—¬ë„
- **SaaS**: ê¸°ëŠ¥ ì‚¬ìš©ë¥ , ì‚¬ìš©ì ì˜¨ë³´ë”© íš¨ê³¼
- **ë§ˆì¼€íŒ…**: ìº í˜ì¸ ì„±ê³¼, ëœë”© í˜ì´ì§€ ìµœì í™”

ì´ êµ¬ì¡°ë¥¼ í†µí•´ ì‹¤ì‹œê°„ìœ¼ë¡œ ì›¹ì‚¬ì´íŠ¸ ì„±ê³¼ë¥¼ ëª¨ë‹ˆí„°ë§í•˜ê³  ë°ì´í„° ê¸°ë°˜ ì˜ì‚¬ê²°ì •ì„ ì§€ì›í•˜ëŠ” ì™„ì „í•œ ì›¹ ë¶„ì„ í”Œë«í¼ì„ ì œê³µí•©ë‹ˆë‹¤.