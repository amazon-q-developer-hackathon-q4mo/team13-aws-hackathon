# LiveInsight ë°°í¬ ê°€ì´ë“œ

## ğŸ“‹ ë°°í¬ ê°œìš”

LiveInsightëŠ” AWS ì„œë²„ë¦¬ìŠ¤ ì•„í‚¤í…ì²˜ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•œ ì‹¤ì‹œê°„ ì›¹ì‚¬ì´íŠ¸ ì‚¬ìš©ì í–‰ë™ ë¶„ì„ ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤. ì´ ê°€ì´ë“œëŠ” ì „ì²´ ì¸í”„ë¼ë¥¼ ì²˜ìŒë¶€í„° ë°°í¬í•˜ëŠ” ë°©ë²•ì„ ì„¤ëª…í•©ë‹ˆë‹¤.

## ğŸ—ï¸ ì•„í‚¤í…ì²˜ ë‹¤ì´ì–´ê·¸ë¨

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ì›¹ì‚¬ì´íŠ¸   â”‚â”€â”€â”€â–¶â”‚ API Gateway  â”‚â”€â”€â”€â–¶â”‚   Lambda    â”‚â”€â”€â”€â–¶â”‚  DynamoDB    â”‚
â”‚ (JS ì¶”ì )   â”‚    â”‚              â”‚    â”‚ EventCollectorâ”‚    â”‚   Tables     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚                    â”‚                   â”‚
                           â”‚                    â–¼                   â”‚
                           â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
                           â”‚            â”‚ CloudWatch  â”‚             â”‚
                           â”‚            â”‚ Monitoring  â”‚             â”‚
                           â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
                           â”‚                                        â”‚
                           â–¼                                        â–¼
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚ Django API   â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ ActiveSessionsâ”‚
                   â”‚ (ê°œë°œì B)   â”‚                        â”‚   (TTL 30ë¶„)  â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ› ï¸ ì‚¬ì „ ìš”êµ¬ì‚¬í•­

### í•„ìˆ˜ ë„êµ¬
- **AWS CLI** (v2.0+)
- **Terraform** (v1.0+)
- **Python** (3.9+)
- **Git**

### AWS ê¶Œí•œ
ë‹¤ìŒ AWS ì„œë¹„ìŠ¤ì— ëŒ€í•œ ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤:
- DynamoDB (í…Œì´ë¸” ìƒì„±/ê´€ë¦¬)
- Lambda (í•¨ìˆ˜ ìƒì„±/ê´€ë¦¬)
- API Gateway (REST API ìƒì„±/ê´€ë¦¬)
- IAM (ì—­í• /ì •ì±… ìƒì„±/ê´€ë¦¬)
- CloudWatch (ë©”íŠ¸ë¦­/ì•ŒëŒ ìƒì„±/ê´€ë¦¬)

## ğŸš€ ë°°í¬ ë‹¨ê³„

### 1ë‹¨ê³„: í™˜ê²½ ì„¤ì •

```bash
# ì €ì¥ì†Œ í´ë¡ 
git clone https://github.com/amazon-q-developer-hackathon-q4mo/team13-aws-hackathon.git
cd team13-aws-hackathon

# AWS CLI ì„¤ì • í™•ì¸
aws configure list
aws sts get-caller-identity

# ë¦¬ì „ ì„¤ì • (us-east-1 ê¶Œì¥)
export AWS_DEFAULT_REGION=us-east-1
```

### 2ë‹¨ê³„: Terraform ì´ˆê¸°í™”

```bash
cd infrastructure

# Terraform ì´ˆê¸°í™”
terraform init

# ë°°í¬ ê³„íš í™•ì¸
terraform plan

# ë³€ìˆ˜ íŒŒì¼ í™•ì¸ (í•„ìš”ì‹œ ìˆ˜ì •)
cat terraform.tfvars
```

### 3ë‹¨ê³„: ì¸í”„ë¼ ë°°í¬

```bash
# ìë™ ë°°í¬ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰
chmod +x deploy.sh
./deploy.sh

# ë˜ëŠ” ìˆ˜ë™ ë°°í¬
terraform apply -auto-approve
```

### 4ë‹¨ê³„: ë°°í¬ ê²€ì¦

```bash
# ë°°í¬ ìƒíƒœ í™•ì¸
terraform output

# API í…ŒìŠ¤íŠ¸
curl -X POST $(terraform output -raw api_gateway_url)/events \
  -H "Content-Type: application/json" \
  -d '{
    "user_id": "deploy_test",
    "event_type": "page_view",
    "page_url": "https://example.com/test"
  }'
```

## ğŸ“Š ë°°í¬ë˜ëŠ” ë¦¬ì†ŒìŠ¤

### DynamoDB í…Œì´ë¸” (3ê°œ)
```
LiveInsight-Events
â”œâ”€â”€ PK: event_id (String)
â”œâ”€â”€ SK: timestamp (Number)
â”œâ”€â”€ GSI: UserIndex (user_id, timestamp)
â””â”€â”€ GSI: SessionIndex (session_id, timestamp)

LiveInsight-Sessions
â”œâ”€â”€ PK: session_id (String)
â””â”€â”€ GSI: UserIndex (user_id, start_time)

LiveInsight-ActiveSessions
â”œâ”€â”€ PK: session_id (String)
â””â”€â”€ TTL: expires_at (30ë¶„)
```

### Lambda í•¨ìˆ˜ (1ê°œ)
```
LiveInsight-EventCollector
â”œâ”€â”€ Runtime: Python 3.9
â”œâ”€â”€ Memory: 512MB
â”œâ”€â”€ Timeout: 30ì´ˆ
â”œâ”€â”€ Environment Variables:
â”‚   â”œâ”€â”€ EVENTS_TABLE=LiveInsight-Events
â”‚   â”œâ”€â”€ SESSIONS_TABLE=LiveInsight-Sessions
â”‚   â””â”€â”€ ACTIVE_SESSIONS_TABLE=LiveInsight-ActiveSessions
â””â”€â”€ X-Ray Tracing: Active
```

### API Gateway (1ê°œ)
```
LiveInsight-API
â”œâ”€â”€ Type: REST API
â”œâ”€â”€ Stage: prod
â”œâ”€â”€ Endpoint: /events (POST, OPTIONS)
â”œâ”€â”€ CORS: Enabled
â””â”€â”€ Integration: Lambda Proxy
```

### CloudWatch ëª¨ë‹ˆí„°ë§
```
Custom Metrics:
â”œâ”€â”€ LiveInsight/EventsProcessed
â””â”€â”€ LiveInsight/ProcessingTime

Alarms:
â”œâ”€â”€ LiveInsight-Lambda-ErrorRate
â”œâ”€â”€ LiveInsight-Lambda-Duration
â””â”€â”€ LiveInsight-DynamoDB-Throttles
```

## ğŸ”§ í™˜ê²½ë³„ ë°°í¬

### ê°œë°œ í™˜ê²½
```bash
# ê°œë°œìš© ë³€ìˆ˜ ì„¤ì •
cat > terraform.tfvars << EOF
aws_region = "us-east-1"
environment = "development"
project_name = "LiveInsight-Dev"
EOF

terraform apply -var-file=terraform.tfvars
```

### í”„ë¡œë•ì…˜ í™˜ê²½
```bash
# í”„ë¡œë•ì…˜ìš© ë³€ìˆ˜ ì„¤ì •
cat > terraform.tfvars << EOF
aws_region = "us-east-1"
environment = "production"
project_name = "LiveInsight"
EOF

terraform apply -var-file=terraform.tfvars
```

## ğŸ“ ë°°í¬ í›„ ì„¤ì •

### 1. API Gateway URL í™•ì¸
```bash
# API Gateway URL ì¶œë ¥
terraform output api_gateway_url

# í™˜ê²½ ë³€ìˆ˜ë¡œ ì €ì¥
export API_GATEWAY_URL=$(terraform output -raw api_gateway_url)
echo "API Gateway URL: $API_GATEWAY_URL"
```

### 2. CloudWatch ëŒ€ì‹œë³´ë“œ ì„¤ì •
```bash
# ëŒ€ì‹œë³´ë“œ URL ìƒì„±
echo "CloudWatch Dashboard: https://console.aws.amazon.com/cloudwatch/home?region=$AWS_DEFAULT_REGION#dashboards:"
```

### 3. ê°œë°œì B ì—°ë™ ì •ë³´
```bash
# ì—°ë™ ì •ë³´ ì¶œë ¥
echo "=== ê°œë°œì B ì—°ë™ ì •ë³´ ==="
echo "API Gateway URL: $(terraform output -raw api_gateway_url)"
echo "Events Table: $(terraform output -raw events_table_name)"
echo "Sessions Table: $(terraform output -raw sessions_table_name)"
echo "ActiveSessions Table: $(terraform output -raw active_sessions_table_name)"
```

## ğŸ§ª ë°°í¬ ê²€ì¦

### ìë™ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
```bash
# í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ ê¶Œí•œ ë¶€ì—¬
chmod +x ../í…ŒìŠ¤íŠ¸ê°€ì´ë“œ.mdì˜ ìŠ¤í¬ë¦½íŠ¸ë“¤

# ì „ì²´ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸
python3 api_test.py
python3 dynamodb_test.py
python3 monitoring_test.py
```

### ìˆ˜ë™ ê²€ì¦
```bash
# 1. DynamoDB í…Œì´ë¸” ìƒíƒœ í™•ì¸
aws dynamodb list-tables --query 'TableNames[?contains(@, `LiveInsight`)]'

# 2. Lambda í•¨ìˆ˜ ìƒíƒœ í™•ì¸
aws lambda get-function --function-name LiveInsight-EventCollector

# 3. API Gateway í…ŒìŠ¤íŠ¸
curl -X OPTIONS $API_GATEWAY_URL/events
curl -X POST $API_GATEWAY_URL/events \
  -H "Content-Type: application/json" \
  -d '{"user_id":"test","event_type":"page_view","page_url":"https://example.com"}'

# 4. CloudWatch ë©”íŠ¸ë¦­ í™•ì¸
aws cloudwatch list-metrics --namespace LiveInsight
```

## ğŸ”„ ì—…ë°ì´íŠ¸ ë° ì¬ë°°í¬

### ì½”ë“œ ì—…ë°ì´íŠ¸
```bash
# Lambda í•¨ìˆ˜ ì½”ë“œë§Œ ì—…ë°ì´íŠ¸
zip -f lambda_function.zip lambda_function.py
aws lambda update-function-code \
  --function-name LiveInsight-EventCollector \
  --zip-file fileb://lambda_function.zip
```

### ì¸í”„ë¼ ì—…ë°ì´íŠ¸
```bash
# Terraformìœ¼ë¡œ ì¸í”„ë¼ ì—…ë°ì´íŠ¸
terraform plan
terraform apply
```

### ë¡¤ë°±
```bash
# ë¡¤ë°± ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰
chmod +x rollback.sh
./rollback.sh

# ë˜ëŠ” Terraformìœ¼ë¡œ ì´ì „ ìƒíƒœ ë³µì›
terraform apply -target=aws_lambda_function.event_collector
```

## ğŸ—‘ï¸ ë¦¬ì†ŒìŠ¤ ì‚­ì œ

### ì „ì²´ ì‚­ì œ
```bash
# Terraformìœ¼ë¡œ ëª¨ë“  ë¦¬ì†ŒìŠ¤ ì‚­ì œ
terraform destroy -auto-approve

# í™•ì¸
aws dynamodb list-tables --query 'TableNames[?contains(@, `LiveInsight`)]'
```

### ì„ íƒì  ì‚­ì œ
```bash
# íŠ¹ì • ë¦¬ì†ŒìŠ¤ë§Œ ì‚­ì œ
terraform destroy -target=aws_dynamodb_table.events
terraform destroy -target=aws_lambda_function.event_collector
```

## ğŸ’° ë¹„ìš© ìµœì í™”

### ì˜ˆìƒ ë¹„ìš© (ì›”ê°„)
```
DynamoDB (í”„ë¡œë¹„ì €ë‹ ëª¨ë“œ):
â”œâ”€â”€ ì½ê¸° ìš©ëŸ‰ 5 ìœ ë‹› Ã— 3 í…Œì´ë¸” = ~$6
â””â”€â”€ ì“°ê¸° ìš©ëŸ‰ 5 ìœ ë‹› Ã— 3 í…Œì´ë¸” = ~$6

Lambda:
â”œâ”€â”€ ìš”ì²­ 100ë§Œê±´ = ~$0.20
â””â”€â”€ ì‹¤í–‰ ì‹œê°„ (512MB, 134ms) = ~$2

API Gateway:
â””â”€â”€ ìš”ì²­ 100ë§Œê±´ = ~$3.50

ì´ ì˜ˆìƒ ë¹„ìš©: ~$18/ì›” (100ë§Œ ìš”ì²­ ê¸°ì¤€)
```

### ë¹„ìš© ì ˆì•½ ë°©ë²•
```bash
# DynamoDB On-Demand ëª¨ë“œë¡œ ë³€ê²½ (íŠ¸ë˜í”½ì´ ë¶ˆê·œì¹™í•œ ê²½ìš°)
terraform apply -var="billing_mode=PAY_PER_REQUEST"

# Lambda ë©”ëª¨ë¦¬ ìµœì í™” (ì‚¬ìš©ëŸ‰ì— ë”°ë¼ 256MBë¡œ ì¡°ì •)
terraform apply -var="lambda_memory=256"
```

## ğŸš¨ íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### ì¼ë°˜ì ì¸ ë¬¸ì œ

#### 1. Terraform ì´ˆê¸°í™” ì‹¤íŒ¨
```bash
# í•´ê²°ë°©ë²•
rm -rf .terraform
terraform init
```

#### 2. IAM ê¶Œí•œ ë¶€ì¡±
```bash
# í•„ìš”í•œ ê¶Œí•œ í™•ì¸
aws iam simulate-principal-policy \
  --policy-source-arn $(aws sts get-caller-identity --query Arn --output text) \
  --action-names dynamodb:CreateTable lambda:CreateFunction
```

#### 3. Lambda ë°°í¬ ì‹¤íŒ¨
```bash
# ë¡œê·¸ í™•ì¸
aws logs describe-log-groups --log-group-name-prefix /aws/lambda/LiveInsight

# í•¨ìˆ˜ ìƒíƒœ í™•ì¸
aws lambda get-function --function-name LiveInsight-EventCollector
```

#### 4. API Gateway 5xx ì—ëŸ¬
```bash
# CloudWatch ë¡œê·¸ í™•ì¸
aws logs filter-log-events \
  --log-group-name /aws/lambda/LiveInsight-EventCollector \
  --start-time $(date -d '1 hour ago' +%s)000
```

## ğŸ“ ì§€ì› ë° ë¬¸ì˜

### ë¬¸ì„œ ì°¸ì¡°
- [AWS Lambda ê°œë°œì ê°€ì´ë“œ](https://docs.aws.amazon.com/lambda/)
- [Amazon DynamoDB ê°œë°œì ê°€ì´ë“œ](https://docs.aws.amazon.com/dynamodb/)
- [Amazon API Gateway ê°œë°œì ê°€ì´ë“œ](https://docs.aws.amazon.com/apigateway/)

### ë¡œê·¸ ë° ëª¨ë‹ˆí„°ë§
- **CloudWatch ë¡œê·¸**: `/aws/lambda/LiveInsight-EventCollector`
- **CloudWatch ë©”íŠ¸ë¦­**: `LiveInsight` ë„¤ì„ìŠ¤í˜ì´ìŠ¤
- **X-Ray íŠ¸ë ˆì´ì‹±**: Lambda í•¨ìˆ˜ì—ì„œ í™œì„±í™”ë¨

ì´ ë°°í¬ ê°€ì´ë“œë¥¼ ë”°ë¼í•˜ë©´ LiveInsight ì¸í”„ë¼ë¥¼ ì„±ê³µì ìœ¼ë¡œ ë°°í¬í•˜ê³  ìš´ì˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.